TODO：
	0，素材：
		1， 现在spc素材和atk、mov中的方向是不一致的，需要更改前两种图片方向的顺序。
			按照下->右->上->左的逆时针顺为好。因此需要修改一系列的地方。(done)
		2，UI的其他图标。
		3，添加音效资源。
		4，缺少攻击时的红色阴影区域图片
		5，Infobox：缺少经验值图标、武器和装备经验值图标。
	1，框架/流程逻辑
		1，完成回合制框架。(ongoing)
		2，继续调整行动流程。考虑结合jQuery把基于浏览器的取消操作做出来。(真的要做？)
		3，需要做一个对话框的逻辑。完成各种各样的功能。（用confirm实现）
		4，重构攻击流程，尤其是InfoBox那一块。用队列控制各个行为的播放。(done)
		5，因为要考虑AOE的情况。所以defenders需要用队列。结合事件队列需要重构 (done)
	2，功能
		1，完成基本的AI。
			“坚守原地”和“积极攻击”，这应该是最容易实现的两种AI
			等地图的加成和可移动区域设定完成之后可以加入下一种AI——“目标移动”
		2，攻击防御、双击、爆击的设定没有加上。
	2，动画/音乐/特效
		1，InfoBox中，预期伤害、预期恢复的页面效果没有做。（因为没有悬停的效果。是否要改成单机显示，再点击攻击的形式？）
		2，添加音乐音效功能
		3，InfoBox在加攻击经验的时候应该是三行。(done)
			经验值应该有其进度条，底下是武器、防具经验（限我方单位, ongoing）
		4，攻击动画不够流畅
		5，人物在攻击完成之后应该是静止站立然后变黑。现在没有加入变黑的效果。
		6，攻击时的可选区域应该是红色阴影。
	3，数值/计算逻辑
		1，地图判定上存在xy错位的情况。由data.json读入的矩阵必须反过来才能正常判定。
		2，功防伤害计算逻辑还未添加。
		3，没有移动力消耗的效果，现在通过敌方单位身边完全没有损耗
		4，攻击框在不可移动地区出现的时候颜色异常。
	4，剧情/人物设计
		1，主人公不能够用项羽了。改高祖传好了。。
	5，BUG/其他细节


※类的包含关系图（注意：这不是继承关系图）

System (Global)
|
|---GameMain
	|
	|---Map
	|
	|---BattleController
		|
		|---Grid
		|
		|---Button
		|
		|---Matrix
		|
		|---InfoBox
		|
		|---Unit
			|
			|---Attr

20120909
	1，修改了攻击流程的一个bug
	2，感觉需要添加游戏基本的控制逻辑。功能扩展方面应该先停一停。
	3，地图可否移动的部分修正。现在加入了基本的地图矩阵
	4，调整了素材图片的方向顺序。现在人物的所有素材顺序已经一致

20120812
	1，添加了我方经验条的动画。
	2，重构了InfoBox更新的逻辑。
	3，将攻防逻辑扩展至一对多。


20120811
	1，调整了开发日志的布局。
	2，将原来的Map类拆分成Map和BattleController。
		Map类只负责显示地图
		BattleController负责所有单位、特效的显示和基本全局回合逻辑。
	3，加入了事件缓冲队列，用以控制各个事件的播放。

20120804
	1，修正了攻击不能取消的bug
	2，添加了人物攻击、移动之后的静止效果。为回合制框架做准备
	3，将对象分到三个不同的队列中，为回合制框架做准备

20120729
	1，完成了升级动画。
	2，修改了出发状态信息的条件。现在是拖动开始时会显示状态信息。
	3，向arctic添加了MovieClip的播放完成事件。现在只要在MovieClip上直接addListener就可以了。
	4，稍微整理了各个动画的addListener的部分，去掉了添加多重listener的动画。

20120728
	1，完成了地图分层。地图的绘制放到了另外一个canvas里头，用jQuery控制
	2，完成了场景内元素的分层绘制。分成了
		UI层
		单位层
		效果层
		绘制顺序由下往上，UI层最后描画，显示在最上层。
	3，调整了行动的流程。开始的时候不显示菜单。
	4，加入了准备行动期的攻击范围显示。
	5，重新整理了图片的布局
	6，改掉了arctic.js点击区域异常的bug。

1326         _updateSize:function(){
1327             var minX = 0, minY = 0, maxX = 0, maxY = 0;
1328             var len = this._displayArr.length;
1329             var frameWidth = 0;
1330             for(var i = 0; i < len; i++){
1331                 var disp = this._displayArr[i];
1332 
1333                 var tminX = disp._screenRect[0],
1334                     tminY = disp._screenRect[1],
1335                     tmaxX = disp._screenRect[0] + disp._screenRect[2],
1336                     tmaxY = disp._screenRect[1] + disp._screenRect[3];
1337 ---------->
1338                 if (tmaxX > tminX + disp._frameWidth) {
1339                     tmaxX = tminX + disp._frameWidth;
1340                 }
1341 ---------->
1342                 if(i == 0){
1343                     minX = tminX;
1344                     minY = tminY;
1345                     maxX = tmaxX;
1346                     maxY = tmaxY;
1347                 }
1348                 if(tminX < minX) minX = tminX;
1349                 if(tmaxX > maxX) maxX = tmaxX;
1350                 if(tminY < minY) minY = tminY;
1351                 if(tmaxY > maxY) maxY = tmaxY;
1352 
1353             }



20120722
	完成了以下内容：
		1：经验值动画，并且跟整个攻击流程串联起来。
		2：添加了虚弱动画。
		3：添加了人物死亡动画。


20120721
	今天完成了以下内容。
		1：理顺了菜单、基本信息的弹出逻辑。
		2：添加了受伤的伤害动画。
		3：添加了受伤的信息表示动画。
	

20120715
	将点击区域大于实际区域的bug报给邮件组了。
		这个问题只有在clip了image的一个区域的时候才会发生。
		估计是System.getImage和其他模块没配合好吧。

	下午搞定基本的status页面。
	
	总算搞定了基本的status页面。


20120714
	完成了移动阴影、UI的一些基本图像素材的处理。

20120711
	今天整理了UI的部分逻辑。
		将移动和攻击串了起来。
		加入了状态机，防止Unit状态乱掉。
		加入了取消功能，可以取消当前的操作，方法是再点击一下角色本身。
		（感觉这个体验不太好，不过考虑到手机上没有右键，取消的问题还真得好好考虑一下）

20120710
	整理的移动流程的部分代码
	整理和分析了攻击流程。
	添加了属性的子类。在json中加入了属性的数据。


	注意，曹操传中在选择攻击对象的时候鼠标悬停在对象上是可以显示出对象预期伤害的。
	因为在手机上没有这个操作，所以需要仔细考虑日后如何处理这个流程。

20120706
	更新了新版的arctic.js v0.1.9
	接下来要把数据和代码分离，包括：
		0，各类常数
		1，关卡的地图数据
		2，关卡的角色数据
	目前分离出来的数据放到JSON中，便于以后本地保存或者网络交互。
	注意：JSON数据如果是最后一项的话，加','会报错。
	(已经完成)

	分离数据与代码之后，开始编写人物的基本属性、攻防系统。

20120702
	尝试给游戏分层：地图一层，Unit一层。但是失败了。
	原因是Unit层绘制的时候会盖住Map层的图片，貌似默认不是透明的。
	而且Arctic的本意似乎也不是让开发者使用两个System。
	好在分层以后帧数没有变化。估计是对象太少吧。
	这个只好以后再优化了。


20120628
	修正了攻击动画错位的问题。
		向上向左各偏移8px


20120627
	今天看到一篇关于html5优化的文章。关于Canvas的部分节选如下：
	第一，每个CANVAS就是一个画布，我们要去渲染一个图形的时候， 我们是可以把它分层的。就是像PS里面一样，是一层两层三层。很多用户在做游戏的时候，直接把所有东西仿放到一个层里，一更新所有的东西都要更新。但如果你把它分层，你让背景放在背景层，角色放到角色层。这样的话，我要更新角色的时候，只会更新角色，背景层不需要变。让CPU干的事情更少了，性能自然而然就提升了。

	第二，context.drawImage。不要去缩放图片，我们一开始就犯了一个错误，我们的美工做的图片始终跟我们不一致，然后我们要去缩放图片。因为本身设备它的图片大小是这样的，我们必须按比率缩放图片。缩放图片以后发现在低端设备下，比方说iPad或者iPhone就会非常卡，我们就想为什么？就进行代码上的分析，当用这个方法时候，花费的时候特别多。

	第三，requestAnimationFrame。这是专门为渲染优化的一个方法。它本身的原理是这样的，当浏览器每过一桢的时候，会触发这个方法，当我在触发的时候，Canvas得到这个浏览器已经准备好做下桢的事情。如果用传统的方法，是不会去考虑你更多的东西，它只会知道我过了多少时间，我就要执行。假如说用户之前被阻塞了，每10秒钟执行这一方法，在10秒之内，实际他之前的事情还没有做完，然后这个事情就会被延后。它就是为了动画看上去更流畅而优化的，因为每一桢的时候，它就告诉你说，你可以做一些事情。

	可以改善的是第一条把描画对象分层。
	在Arctic.js中具体就是建多个System类。（这个以后有机会再优化好了）


20120624
	今天完成了一个基本的攻击动画。
	几个需要注意的地方：
		攻击动画不能射程autoplay, loop的模式。
			最好用gotoAndPlay(1)的方式强行从第一帧播放。
			每次播放之前最好手动设定gotoAndStop(1)到第一帧。这样可以防止上次播放的残影出现。
		监听动画播放完成，不能够监听MovieClip，而是要监听里面的SheetMovieClip。本着谁play监听谁的原则。
		攻击动画前四帧是一个蓄力的工作。（现在做成了一个动画，之后为了配合音效可能需要拆成两个动画。）
		接下来要做的是受伤动画以及地图障碍物等等工作。
		准备动画做齐备了以后再加入数值。


20120622
	总算完成了人物的基本走动动画。
	值得注意的是：javascript的变量是引用传递。
	我在将一个对象push到一个队列之后（注意这里push进去的是指针，即不是对象实体）
	将这个对象内的值更改了，发现这个对象在队列里的值也被更改了。
	深拷贝浅拷贝的问题一定要小心。
	还有就是数组的合并用array.concat不知道为什么不好用，最后还是一个个的取出来push进去了
	遗留两个问题：
		1，走动动画不连贯。
			现在没办法动态的调整动画的帧率。
			比如静止是是2帧，走动时是4帧。
			最开始的一次播放是很不连贯的。
			之后再播放的时候就会变得流畅。
			（已经解决）
				只有再建立一组新的动画。
				注意fps是在SheetMovieClip创建的时候就被指定了。
				MovieClip那个值的作用还不清楚。
		2，要合并同一方向上的走动动画。
			如果每走一格就要再拨一次动画，这意味着动画要重新回到初始位置播放。
			显得非常不连贯。所以要合并掉。
			但是现在合并除了点问题。
			（已经解决）
				深浅拷贝的问题，累加距离的时候加到了别的格子的路径上


20120617
	整合了之前写的BFS路径算法。
	但是遇到一个问题：
		BFS返回一个Grid数组，我把每个可行走的道路打上标记。
		addChild的时候，返回的Grid数组中的Grid在被addChild以后，位置在左上角。
		而在本地新建的Grid类。的位置却在正确的位置。


		解决了。
			貌似DisplayObjectContainer继承下来的类不能随便设X,Y
			会导致其中所包含的内容显示异常。

20120616
	完成了一个初步的动画。
	以下是一些使用anim.Animation类的常见问题：
	1，动画的对象obj总是从(0, 0)点开始行动。即不能从一个非原点位置开始移动
	2，动画完成以后会抛出arc.Event.COMPLETE事件。但是已经被改变的位移属性会消失，需要手动更新。
	3，人物走动动画正确的做法是:
		1，点击走动
		2，计算路线
		3，得到路线动画
		4，播放路线动画
		5，动画播放完成之后，进行尾处理。重新设定人物的最新位置。


20120612
	翻转的问题依旧没有解决，发信去邮件组了，看看能不能有回复。
	今天做移动的动画，出现了另外一个问题。就是任务的组合动画无法实现。
		简单点说就是走路的帧动画和位移没办法同时播放。
		这个成问题啊。
	解决了，其实是帧数不够多的问题。
	明天开始做人物四处走动的动画。（折线）
	这周争取把人物的行走动画解决。


20120611
	周末把资源和处理脚本写好了。
	今天开始整理资源写人物动画。
	现在碰到的一个问题是arctic.js没办法处理水平翻转
		在放动画的时候，向左走和向右走的动画是通过翻转得到的
		如果没办法程序处理，最坏情况需要在图片资源中两种全部准备，这样不是很经济啊
		在网上找了个html5翻转的代码flip.js，看看能不恩能够够hack arctic.js


20120606
	今天做了一下地图移动阴影和移动的设计和实现。
		大概是首先用泛洪法得到所有可移动的格子
		然后在每个格子上记录它的路径
		如果这个格子被作为目标进行移动的时候
		路径自然就有了，一个一个拿出来移动即可

		素材得赶紧做，感觉这块不做工作有点进行不下去了。
		这个周末搞定

20120604
	今天主要看了arctic.js的动画实现。
		似乎都是打到anim.Timeline中进行统一调度的。
		update函数很关键。
	最好尽快开始地图和基本人物动画的制作，否则后续工作很难开始。
	为此需要尽快学会资源提取器的使用并且提取出资源。


20120531
	看了一下JSX和Arctic.js都不甚理想，于是还是想要先用GameQuery实现，然后在移植。
	JSX用了Google Closure Compiler实现一个静态类的javascript编译。将原来的javascript编译成更快的代码。
	Arctic.js是一个基于手机的html5引擎。
		编程的风格看上去还行。
		对浏览器的支持不很好。
		后续版本有可能会变得很厉害，所以稳妥起见不采用。
	所以如何将游戏逻辑的描画和UI与主逻辑分开，是非常重要的事情。
	
	但是jQuery/gameQuery/的描画效率实在太低了，在ip4上卡的很。所以准备看一下arctic.js
	arctic.js 的Animation类只能实现对于一个对象的变形和移动。不支持帧动画？！
	帧动画用movieClip类实现

	arctic的好处是封装了loader ajax等等类，可以很好的保护资源与代码
	参照教程，成功用arctic做出一个帧动画。(aqua的鱼图片为例)
		arctic中做帧动画的方法是先切图片。到一个个的SheetMovieClip。
		因为Sheet只能切成一行行的。所以5帧的图片切了4帧共两行。
		每行播两帧，这样就可以了。
		arctic中也可以用关键帧，实现插着播放的效果。
		总之，解决了这个问题，人物动作的实现就指日可待了。

20120530
	仔细研究了一下gameQuery.js (v0.6.2)
	这个库主要包括
		游戏主循环
			sprite动画（刷新）
			tile动画（刷新）
		简单的音乐音效处理
		一些简单的几何函数
			图形图像变换等等
			碰撞检测
	1k多行，应该算是可以彻底hack掉的类型。
	因为这个库实现的部分正好都是我需要的内容（人物动画，地图），所以决定先从学习这个库开始。

20120529
	调研了一下已有的html5引擎。觉得gameQuery不错，它是基于jQuery的一个插件。
	里头有地图编辑器正好可以用。
	http://gameQueryjs.com

20120526
	在可视范围之外将GIF动画做成图片单独下载从而强迫其在Canvas之内的相同GIF播放的方法只有在Chrome中好使。在firefox中就不好用了。
	以后迟早要改成帧动画。需要单独写动画播放器类。

	今天构思了一下剧情。
	战役多而且史料丰富的故事。
	觉得以《项羽传》为主题不错。
	故事可以基本参考《史记》《汉书》。
	最后增加项羽渡江，趁刘邦诛杀功臣之际举兵反攻的剧情。
	感觉会挺不错的。
	故事的主题突出“成长”：即人都有过错，但是如果可以痛定思痛，吸取教训，仍然可以成功。
	以项羽为主人公非常合适。
	以后游戏设定与剧本更新到单独的文件上

	封装了lib.js，学习了一些基本的类的写法。
	编写了GameObject, Unit, Grid, Attr这几个类
	
	继承关系如下:
	Class
	|
	|
	-------------------
	|     |     |     |
	Point Size  Rect  Attr
                |
				GameObject
				|
				-------
				|     |
				Unit　Grid

	尝试用grid画map作图，不过貌似效率非常低。
	所以还是改用绘制一整张图片作为map的做法。具体grid再切uv好了。

20120524
	想要编写地图的基础类。
		不过变量的声明周期和作用域的知识不是很清楚。进展不大。明天继续


20120523
	编写了一个简单的走动的效果。
		即设定目标节点(x, y)。如果不达到条件就一直运动每次刷新时，x, y各更新 speedX, speedY。
		问题：走动时gif的速度是无法调控的，达不到曹操传的效果。所以作为成品肯定要做成帧动画。
	稍微该把代码稍微整理一下了

20120522
	如果画面中出现了同一个图像的gif动画，则canvas中的gif也变成动画
	DOM元素的show() 和 hide()等函数是jQuery提供的效果
	w3school有jQuery的所有方法和属性手册，可以参考

20120521
	HTML5canvas无法播放一个gif动画
		需要将gif动画分解成序列帧格式，然后用javascript控制播放


20120520
	Hacked  tutorial for basic game framework, includes:
		gameloop
		manipulate canvas mousemove show/hide DOM elements
		fps

	Edk5 SE added

	Future works:
		a basic map
		character unit
		character status UI
		battle order menu
		basic animations
			move
			attack
			hurt
			die
		basic calculations

	resource load is case sensitive, need to be care about this.

20120518
	
	系统基本框架调研 (HTML5 + CSS3 + Javascript)
		
		modernizr
	http://modernizr.com/
			
			内嵌了 yepenope
			
		sizzle
		http://sizzlejs.com/
			内嵌了 jQuery
	
	游戏架构调研
		
		战斗场景
			
			地图
			
			人物gif
				
				静态
				
				走动（四个朝向）
				
				攻击
				
				防御
				
				受伤
				
				濒死
			
				控制菜单
			
				音乐
			
				音效
			
				基本逻辑
			
				敌人AI
		
	收集基本素材
		
	编写基本逻辑
		
	先出prototype，再优化，最后嵌入到框架中
